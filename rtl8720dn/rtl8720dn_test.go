package rtl8720dn

import (
	"reflect"
	"testing"
)

func TestResponseIPD(t *testing.T) {
	tests := []struct {
		summary        string
		input          []string
		expectedHeader string
		expectedBody   string
		expectedStates []IpdState
	}{
		{
			summary: "normal",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			expectedStates: []IpdState{stIpdRead1, stIpdParse1, stIpdHeader1, stIpdBody1},
		},
		{
			summary: "normal 2",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:",
				"HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			expectedStates: []IpdState{stIpdRead1, stIpdParse1, stIpdRead2, stIpdHeader1, stIpdBody1},
		},
		{
			summary: "normal 3",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:",
				"HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
				"<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			expectedStates: []IpdState{stIpdRead1, stIpdParse1, stIpdRead2, stIpdHeader1, stIpdRead4, stIpdBody1},
		},
		{
			summary: "normal 4",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:",
				"HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
				"<!DOCTYPE html>\n",
				"<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},
		{
			summary: "normal 5",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:",
				"HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
				"<!DOCTYPE html>\n",
				"<html>\n",
				"<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},
		{
			summary: "normal 6",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:",
				"HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
				"<!DOCTYPE html>\n",
				"<html>\n",
				"<",
				"head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},
		{
			summary: "normal 7 (stIpdParse1 : end-start < 7)",
			input: []string{
				"\r\n+IPD",
				",0,845,192.168.1.110,80:HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},
		{
			summary: "normal 8 (read length == 0)",
			input: []string{
				"",
				"\r\n+IPD,0,845,192.168.1.110,80:HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},
		{
			summary: "normal 8 (stIpdHeader1 : endOfHeader < - 1)",
			input: []string{
				"\r\n+IPD,0,845,192.168.1.110,80:HTTP/1.1 200 OK\r\n",
				"Server: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},
		{
			summary: "normal 9 (stIpdHeader1 : endOfHeader < - 1)",
			input: []string{
				"\r\n+IPD,0,233,192.168.1.110,80:HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
				"\r\n+IPD,0,612,192.168.1.110,80:<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
			},
			expectedHeader: "HTTP/1.1 200 OK\r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 00:50:32 GMT\r\nContent-Type: text/html\r\nContent-Length: 612\r\nLast-Modified: Tue, 19 Nov 2019 14:18:58 GMT\r\nConnection: close\r\nETag: \"5dd3f9d2-264\"\r\nAccept-Ranges: bytes\r\n\r\n",
			expectedBody:   "<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\n    body {\n        width: 35em;\n        margin: 0 auto;\n        font-family: Tahoma, Verdana, Arial, sans-serif;\n    }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href=\"http://nginx.org/\">nginx.org</a>.<br/>\nCommercial support is available at\n<a href=\"http://nginx.com/\">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n",
		},

		{
			summary: "normal2",
			input: []string{
				"\r\n+IPD,0,1460,192.168.1.110,80:",
				"HTTP/1.1 200 \r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 02:21:52 GMT\r\nContent-Type: text/html;charset=UTF-8\r\nContent-Length: 8061\r\nConnection: close\r\nSet-Cookie: JSESSIONID=0CC7A5D38E880FC8F2000549B94ED84B; Path=/gitbucket2020; Secure; HttpOnly\r\n\r\n<!DOCTYPE html>\n<html prefix=\"og: http://ogp.me/ns#\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <title>Sign in</title>\n    <meta property=\"og:title\" content=\"Sign in\" />\n    <meta property=\"og:type\" content=\"object\" />\n    <meta property=\"og:url\" content=\"http://127.0.0.1:18080/gitbucket2020/signin\" />\n    \n      <meta property=\"og:image\" content=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket_ogp.png\" />\n    \n    \n    <link rel=\"icon\" href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.png?20200927111811\" type=\"image/vnd.microsoft.icon\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-fonts/css/source-sans-pro.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/css/bootstrap.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/v\r\n+IPD,0,1460,192.168.1.110,80:endors/octicons-4.4.0/octicons.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/css/bootstrap-datetimepicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/css/bootstrap-colorpicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.css?20200927111811\" type=\"text/css\" rel=\"stylesh",
				"eet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.css?20200927111811\" rel=\"stylesheet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/AdminLTE.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/skins/skin-blue.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/font-awesome-4.7.0/css/font-awesome.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.structure.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.examp\r\n+IPD,0,1460,192.168.1.110,80:",
				"le.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.theme.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/css/gitbucket.css?20200927111811\" rel=\"stylesheet\">\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery/jquery-3.4.1.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/dropzone/dropzone.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/validation.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/gitbucket.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/js/bootstrap.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap3-typeahead/bootstrap3-typeahead.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/moment.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/bootstrap-datetimepicker.min.js?20200927111811\"></script>\n    <scri\r\n+IPD,0,1460,192.168.1.110,80:pt src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/js/bootstrap-colorpicker.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/elastic/jquery.elastic.source.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh",
				".example.com/gitbucket2020/assets/vendors/jquery-hotkeys/jquery.hotkeys.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-textcomplete-1.8.4/jquery.textcomplete.min.js?20200927111811\"></script>\n    \n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/js/adminlte.min.js?20200927111811\" type=\"text/javascript\"></script>\n  </head>\n  <body class=\"skin-blue page-load  \">\n    <div class=\"wrapper\">\n      <header class=\"main-header\">\n        <a href=\"https://abcdefgh.example.com/gitbucket2020/\" class=\"logo\">\n          <span class=\"logo-mini\"><img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20200927111811\" alt=\"GitBucket\" /></span>\n          <span class=\"logo-lg\">\n            <img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20\r\n+IPD,0,1460,192.168.1.110,80:",
				"200927111811\" alt=\"GitBucket\" />\n            <span class=\"header-title strong\">GitBucket</span>\n          </span>\n        </a>\n        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n          <!-- Sidebar toggle button-->\n          \n          <form id=\"search\" action=\"https://abcdefgh.example.com/gitbucket2020/search\" method=\"GET\" class=\"pc navbar-form navbar-left\" role=\"search\">\n            <div class=\"form-group\">\n              <input type=\"text\" name=\"query\" id=\"navbar-search-input\" class=\"form-control\" placeholder=\"Search repository\"/>\n            </div>\n          </form>\n          <ul class=\"pc nav navbar-nav\">\n            \n            \n              \n                <li><a href=\"https://abcdefgh.example.com/gitbucket2020/gist\">Snippets</a></li>\n              \n            \n          </ul>\n          <div class=\"navbar-custom-menu\">\n            <ul class=\"nav navbar-nav\">\n              \n                <li>\n                  <a href=\"https://abcdefgh.example.com/gitbucket2020/signin?redirect=%2Fsignin\" class=\"pull-right\" id=\"signin\">Sign in</a>\n                </li>\n              \n            </ul>\n          </div>\n        </nav>\n      </header>\n      \n  <div class=\"content-wrapper main-center\">\n    <div class=\"content body\">\n      <div class=\"signin-form\">\n        \n        \n        <div class=\"panel panel-default\">\n  <div class=\"panel-heading strong\">Sign in</div>\n  <ul class=\"list-group list-group-flush\">\n    \n    <li cla",
				"\r\n+IPD,0,1013,192.168.1.110,80:ss=\"list-group-item\">\n      <form action=\"https://abcdefgh.example.com/gitbucket2020/signin\" method=\"POST\" validate=\"true\" autocomplete=\"off\">\n        <div class=\"form-group\">\n          <label for=\"userName\">Username:</label>\n          <span id=\"error-userName\" class=\"error\"></span>\n          <input type=\"text\" name=\"userName\" id=\"userName\" class=\"form-control\" autofocus value=\"\"/>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"password\">Password:</label>\n          <span id=\"error-password\" class=\"error\"></span>\n          <input type=\"password\" name=\"password\" id=\"password\" class=\"form-control\" value=\"\"/>\n        </div>\n        <input type=\"hidden\" name=\"hash\"/>\n        <input type=\"submit\" class=\"btn btn-success\" value=\"Sign in\" onClick=\"this.form.hash.value = window.location.hash;\"/>\n        \n      </form>\n    </li>\n  </ul>\n</div>\n\n      </div>\n    </div>\n  </div>\n\n    </div>\n    <script>\n      $(function(){\n        \n        \n      });\n    </script>\n    \n  </body>\n</html>\n\n",
			},
			expectedHeader: "HTTP/1.1 200 \r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 02:21:52 GMT\r\nContent-Type: text/html;charset=UTF-8\r\nContent-Length: 8061\r\nConnection: close\r\nSet-Cookie: JSESSIONID=0CC7A5D38E880FC8F2000549B94ED84B; Path=/gitbucket2020; Secure; HttpOnly\r\n\r\n",
			expectedBody: "<!DOCTYPE html>\n<html prefix=\"og: http://ogp.me/ns#\">\n  <head>\n    <meta charset=\"UTF-8\" />\n" +
				"    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <title>Sign in</title>\n    <meta property=\"og:title\" content=\"Sign in\" />\n    <meta property=\"og:type\" content=\"object\" />\n    <meta property=\"og:url\" content=\"http://127.0.0.1:18080/gitbucket2020/signin\" />\n    \n      <meta property=\"og:image\" content=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket_ogp.png\" />\n    \n    \n    <link rel=\"icon\" href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.png?20200927111811\" type=\"image/vnd.microsoft.icon\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-fonts/css/source-sans-pro.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/css/bootstrap.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/octicons-4.4.0/octicons.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/css/bootstrap-datetimepicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/css/bootstrap-colorpicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.css?20200927111811\" type=\"text/css\" rel=\"stylesheet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.css?20200927111811\" rel=\"stylesheet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/AdminLTE.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/skins/skin-blue.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/font-awesome-4.7.0/css/font-awesome.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.structure.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.theme.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/css/gitbucket.css?20200927111811\" rel=\"stylesheet\">\n" +
				"    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery/jquery-3.4.1.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/dropzone/dropzone.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/validation.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/gitbucket.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/js/bootstrap.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap3-typeahead/bootstrap3-typeahead.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/moment.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/bootstrap-datetimepicker.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/js/bootstrap-colorpicker.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.js?20200927111811\"></script>\n" +
				"    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/elastic/jquery.elastic.source.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-hotkeys/jquery.hotkeys.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-textcomplete-1.8.4/jquery.textcomplete.min.js?20200927111811\"></script>\n    \n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/js/adminlte.min.js?20200927111811\" type=\"text/javascript\"></script>\n  </head>\n  <body class=\"skin-blue page-load  \">\n    <div class=\"wrapper\">\n      <header class=\"main-header\">\n        <a href=\"https://abcdefgh.example.com/gitbucket2020/\" class=\"logo\">\n          <span class=\"logo-mini\"><img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20200927111811\" alt=\"GitBucket\" /></span>\n          <span class=\"logo-lg\">\n            <img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20200927111811\" alt=\"GitBucket\" />\n            <span class=\"header-title strong\">GitBucket</span>\n          </span>\n        </a>\n        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n          <!-- Sidebar toggle button-->\n          \n          <form id=\"search\" action=\"https://abcdefgh.example.com/gitbucket2020/search\" method=\"GET\" class=\"pc navbar-form navbar-left\" role=\"search\">\n            <div class=\"form-group\">\n              <input type=\"text\" name=\"query\" id=\"navbar-search-input\" class=\"form-control\" placeholder=\"Search repository\"/>\n            </div>\n          </form>\n          <ul class=\"pc nav navbar-nav\">\n            \n            \n              \n                <li><a href=\"https://abcdefgh.example.com/gitbucket2020/gist\">Snippets</a></li>\n              \n            \n          </ul>\n          <div class=\"navbar-custom-menu\">\n            <ul class=\"nav navbar-nav\">\n              \n                <li>\n                  <a href=\"https://abcdefgh.example.com/gitbucket2020/signin?redirect=%2Fsignin\" class=\"pull-right\" id=\"signin\">Sign in</a>\n                </li>\n              \n            </ul>\n          </div>\n        </nav>\n      </header>\n      \n  <div class=\"content-wrapper main-center\">\n    <div class=\"content body\">\n      <div class=\"signin-form\">\n        \n        \n        <div class=\"panel panel-default\">\n  <div class=\"panel-heading strong\">Sign in</div>\n  <ul class=\"list-group list-group-flush\">\n    \n    <li class=\"list-group-item\">\n      <form action=\"https://abcdefgh.example.com/gitbucket2020/signin\" method=\"POST\" validate=\"true\" autocomplete=\"off\">\n        <div class=\"form-group\">\n          <label for=\"userName\">Username:</label>\n          <span id=\"error-userName\" class=\"error\"></span>\n          <input type=\"text\" name=\"userName\" id=\"userName\" class=\"form-control\" autofocus value=\"\"/>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"password\">Password:</label>\n          <span id=\"error-password\" class=\"error\"></span>\n          <input type=\"password\" name=\"password\" id=\"password\" class=\"form-control\" value=\"\"/>\n        </div>\n        <input type=\"hidden\" name=\"hash\"/>\n        <input type=\"submit\" class=\"btn btn-success\" value=\"Sign in\" onClick=\"this.form.hash.value = window.location.hash;\"/>\n        \n      </form>\n    </li>\n  </ul>\n</div>\n\n      </div>\n    </div>\n  </div>\n\n    </div>\n    <script>\n      $(function(){\n        \n        \n      });\n    </script>\n    \n  </body>\n</html>\n\n",
			// "
		},
		{
			summary: "normal2 2 (stIpdParse2 : end-start < 7)",
			input: []string{
				"\r\n+IPD,0,1460,192.168.1.110,80:",
				"HTTP/1.1 200 \r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 02:21:52 GMT\r\nContent-Type: text/html;charset=UTF-8\r\nContent-Length: 8061\r\nConnection: close\r\nSet-Cookie: JSESSIONID=0CC7A5D38E880FC8F2000549B94ED84B; Path=/gitbucket2020; Secure; HttpOnly\r\n\r\n<!DOCTYPE html>\n<html prefix=\"og: http://ogp.me/ns#\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <title>Sign in</title>\n    <meta property=\"og:title\" content=\"Sign in\" />\n    <meta property=\"og:type\" content=\"object\" />\n    <meta property=\"og:url\" content=\"http://127.0.0.1:18080/gitbucket2020/signin\" />\n    \n      <meta property=\"og:image\" content=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket_ogp.png\" />\n    \n    \n    <link rel=\"icon\" href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.png?20200927111811\" type=\"image/vnd.microsoft.icon\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-fonts/css/source-sans-pro.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/css/bootstrap.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/v\r\n+IPD",
				",0,1460,192.168.1.110,80:endors/octicons-4.4.0/octicons.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/css/bootstrap-datetimepicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/css/bootstrap-colorpicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.css?20200927111811\" type=\"text/css\" rel=\"stylesh",
				"eet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.css?20200927111811\" rel=\"stylesheet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/AdminLTE.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/skins/skin-blue.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/font-awesome-4.7.0/css/font-awesome.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.structure.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.examp\r\n+IPD,0,1460,192.168.1.110,80:",
				"le.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.theme.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/css/gitbucket.css?20200927111811\" rel=\"stylesheet\">\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery/jquery-3.4.1.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/dropzone/dropzone.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/validation.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/gitbucket.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/js/bootstrap.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap3-typeahead/bootstrap3-typeahead.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/moment.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/bootstrap-datetimepicker.min.js?20200927111811\"></script>\n    <scri\r\n+IPD,0,1460,192.168.1.110,80:pt src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/js/bootstrap-colorpicker.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/elastic/jquery.elastic.source.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh",
				".example.com/gitbucket2020/assets/vendors/jquery-hotkeys/jquery.hotkeys.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-textcomplete-1.8.4/jquery.textcomplete.min.js?20200927111811\"></script>\n    \n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/js/adminlte.min.js?20200927111811\" type=\"text/javascript\"></script>\n  </head>\n  <body class=\"skin-blue page-load  \">\n    <div class=\"wrapper\">\n      <header class=\"main-header\">\n        <a href=\"https://abcdefgh.example.com/gitbucket2020/\" class=\"logo\">\n          <span class=\"logo-mini\"><img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20200927111811\" alt=\"GitBucket\" /></span>\n          <span class=\"logo-lg\">\n            <img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20\r\n+IPD,0,1460,192.168.1.110,80:",
				"200927111811\" alt=\"GitBucket\" />\n            <span class=\"header-title strong\">GitBucket</span>\n          </span>\n        </a>\n        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n          <!-- Sidebar toggle button-->\n          \n          <form id=\"search\" action=\"https://abcdefgh.example.com/gitbucket2020/search\" method=\"GET\" class=\"pc navbar-form navbar-left\" role=\"search\">\n            <div class=\"form-group\">\n              <input type=\"text\" name=\"query\" id=\"navbar-search-input\" class=\"form-control\" placeholder=\"Search repository\"/>\n            </div>\n          </form>\n          <ul class=\"pc nav navbar-nav\">\n            \n            \n              \n                <li><a href=\"https://abcdefgh.example.com/gitbucket2020/gist\">Snippets</a></li>\n              \n            \n          </ul>\n          <div class=\"navbar-custom-menu\">\n            <ul class=\"nav navbar-nav\">\n              \n                <li>\n                  <a href=\"https://abcdefgh.example.com/gitbucket2020/signin?redirect=%2Fsignin\" class=\"pull-right\" id=\"signin\">Sign in</a>\n                </li>\n              \n            </ul>\n          </div>\n        </nav>\n      </header>\n      \n  <div class=\"content-wrapper main-center\">\n    <div class=\"content body\">\n      <div class=\"signin-form\">\n        \n        \n        <div class=\"panel panel-default\">\n  <div class=\"panel-heading strong\">Sign in</div>\n  <ul class=\"list-group list-group-flush\">\n    \n    <li cla",
				"\r\n+IPD,0,1013,192.168.1.110,80:ss=\"list-group-item\">\n      <form action=\"https://abcdefgh.example.com/gitbucket2020/signin\" method=\"POST\" validate=\"true\" autocomplete=\"off\">\n        <div class=\"form-group\">\n          <label for=\"userName\">Username:</label>\n          <span id=\"error-userName\" class=\"error\"></span>\n          <input type=\"text\" name=\"userName\" id=\"userName\" class=\"form-control\" autofocus value=\"\"/>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"password\">Password:</label>\n          <span id=\"error-password\" class=\"error\"></span>\n          <input type=\"password\" name=\"password\" id=\"password\" class=\"form-control\" value=\"\"/>\n        </div>\n        <input type=\"hidden\" name=\"hash\"/>\n        <input type=\"submit\" class=\"btn btn-success\" value=\"Sign in\" onClick=\"this.form.hash.value = window.location.hash;\"/>\n        \n      </form>\n    </li>\n  </ul>\n</div>\n\n      </div>\n    </div>\n  </div>\n\n    </div>\n    <script>\n      $(function(){\n        \n        \n      });\n    </script>\n    \n  </body>\n</html>\n\n",
			},
			expectedHeader: "HTTP/1.1 200 \r\nServer: nginx/1.17.6\r\nDate: Sun, 27 Sep 2020 02:21:52 GMT\r\nContent-Type: text/html;charset=UTF-8\r\nContent-Length: 8061\r\nConnection: close\r\nSet-Cookie: JSESSIONID=0CC7A5D38E880FC8F2000549B94ED84B; Path=/gitbucket2020; Secure; HttpOnly\r\n\r\n",
			expectedBody: "<!DOCTYPE html>\n<html prefix=\"og: http://ogp.me/ns#\">\n  <head>\n    <meta charset=\"UTF-8\" />\n" +
				"    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0\" />\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\n    <title>Sign in</title>\n    <meta property=\"og:title\" content=\"Sign in\" />\n    <meta property=\"og:type\" content=\"object\" />\n    <meta property=\"og:url\" content=\"http://127.0.0.1:18080/gitbucket2020/signin\" />\n    \n      <meta property=\"og:image\" content=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket_ogp.png\" />\n    \n    \n    <link rel=\"icon\" href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.png?20200927111811\" type=\"image/vnd.microsoft.icon\" />\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-fonts/css/source-sans-pro.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/css/bootstrap.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/octicons-4.4.0/octicons.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/css/bootstrap-datetimepicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/css/bootstrap-colorpicker.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.css?20200927111811\" type=\"text/css\" rel=\"stylesheet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.css?20200927111811\" rel=\"stylesheet\"/>\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/AdminLTE.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/css/skins/skin-blue.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/font-awesome-4.7.0/css/font-awesome.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.structure.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.theme.min.css?20200927111811\" rel=\"stylesheet\">\n    <link href=\"https://abcdefgh.example.com/gitbucket2020/assets/common/css/gitbucket.css?20200927111811\" rel=\"stylesheet\">\n" +
				"    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery/jquery-3.4.1.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-ui/jquery-ui.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/dropzone/dropzone.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/validation.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/js/gitbucket.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-3.4.1/js/bootstrap.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap3-typeahead/bootstrap3-typeahead.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/moment.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/bootstrap-datetimepicker-4.17.44/js/bootstrap-datetimepicker.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/colorpicker/js/bootstrap-colorpicker.min.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/google-code-prettify/prettify.js?20200927111811\"></script>\n" +
				"    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/elastic/jquery.elastic.source.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/facebox/facebox.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-hotkeys/jquery.hotkeys.js?20200927111811\"></script>\n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/jquery-textcomplete-1.8.4/jquery.textcomplete.min.js?20200927111811\"></script>\n    \n    <script src=\"https://abcdefgh.example.com/gitbucket2020/assets/vendors/AdminLTE-2.4.2/js/adminlte.min.js?20200927111811\" type=\"text/javascript\"></script>\n  </head>\n  <body class=\"skin-blue page-load  \">\n    <div class=\"wrapper\">\n      <header class=\"main-header\">\n        <a href=\"https://abcdefgh.example.com/gitbucket2020/\" class=\"logo\">\n          <span class=\"logo-mini\"><img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20200927111811\" alt=\"GitBucket\" /></span>\n          <span class=\"logo-lg\">\n            <img src=\"https://abcdefgh.example.com/gitbucket2020/assets/common/images/gitbucket.svg?20200927111811\" alt=\"GitBucket\" />\n            <span class=\"header-title strong\">GitBucket</span>\n          </span>\n        </a>\n        <nav class=\"navbar navbar-static-top\" role=\"navigation\">\n          <!-- Sidebar toggle button-->\n          \n          <form id=\"search\" action=\"https://abcdefgh.example.com/gitbucket2020/search\" method=\"GET\" class=\"pc navbar-form navbar-left\" role=\"search\">\n            <div class=\"form-group\">\n              <input type=\"text\" name=\"query\" id=\"navbar-search-input\" class=\"form-control\" placeholder=\"Search repository\"/>\n            </div>\n          </form>\n          <ul class=\"pc nav navbar-nav\">\n            \n            \n              \n                <li><a href=\"https://abcdefgh.example.com/gitbucket2020/gist\">Snippets</a></li>\n              \n            \n          </ul>\n          <div class=\"navbar-custom-menu\">\n            <ul class=\"nav navbar-nav\">\n              \n                <li>\n                  <a href=\"https://abcdefgh.example.com/gitbucket2020/signin?redirect=%2Fsignin\" class=\"pull-right\" id=\"signin\">Sign in</a>\n                </li>\n              \n            </ul>\n          </div>\n        </nav>\n      </header>\n      \n  <div class=\"content-wrapper main-center\">\n    <div class=\"content body\">\n      <div class=\"signin-form\">\n        \n        \n        <div class=\"panel panel-default\">\n  <div class=\"panel-heading strong\">Sign in</div>\n  <ul class=\"list-group list-group-flush\">\n    \n    <li class=\"list-group-item\">\n      <form action=\"https://abcdefgh.example.com/gitbucket2020/signin\" method=\"POST\" validate=\"true\" autocomplete=\"off\">\n        <div class=\"form-group\">\n          <label for=\"userName\">Username:</label>\n          <span id=\"error-userName\" class=\"error\"></span>\n          <input type=\"text\" name=\"userName\" id=\"userName\" class=\"form-control\" autofocus value=\"\"/>\n        </div>\n        <div class=\"form-group\">\n          <label for=\"password\">Password:</label>\n          <span id=\"error-password\" class=\"error\"></span>\n          <input type=\"password\" name=\"password\" id=\"password\" class=\"form-control\" value=\"\"/>\n        </div>\n        <input type=\"hidden\" name=\"hash\"/>\n        <input type=\"submit\" class=\"btn btn-success\" value=\"Sign in\" onClick=\"this.form.hash.value = window.location.hash;\"/>\n        \n      </form>\n    </li>\n  </ul>\n</div>\n\n      </div>\n    </div>\n  </div>\n\n    </div>\n    <script>\n      $(function(){\n        \n        \n      });\n    </script>\n    \n  </body>\n</html>\n\n",
			// "
		},
	}

	for _, test := range tests {
		d := NewDevice(debug)
		d.set_read_data(test.input)

		buf := make([]byte, 1024*10)
		sz, err := d.ResponseIPD(500, buf)
		if err != nil {
			t.Error(err)
		}

		if sz == 0 {
			t.Errorf("%s: sz == 0", test.summary)
		}

		if g, e := d.header, test.expectedHeader; g != e {
			t.Errorf("%s: header: got %q, want %q", test.summary, g, e)
		}

		if len(test.expectedStates) > 0 {
			if g, e := d.stateHistories, test.expectedStates; !reflect.DeepEqual(g, e) {
				t.Errorf("%s: states: got %#v, want %#v)", test.summary, g, e)
			}
		}

		if g, e := string(buf[:sz]), test.expectedHeader+test.expectedBody; g != e {
			t.Errorf("%s: body: got %#v, want %#v)", test.summary, g, e)
		}
	}
}
